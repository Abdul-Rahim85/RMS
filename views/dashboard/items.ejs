<html lang="ar" dir="rtl">
  <%- include('../layouts/head.ejs') %>
  <body class="bg-light">
    <div class="d-flex flex-shrink-0">
      <!-- Sidebar -->
      <div class="d-flex flex-column flex-shrink-0 p-3 bg-dark text-white" style="width: 220px; height: 100vh;">
        <a href="/" class="d-flex align-items-center mx-auto text-white text-decoration-none">
          <span class="fs-4">نظام مبيعات</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
          <li class="nav-item">
            <a href="/dashboard" class="nav-link text-white">لوحة التحكم</a>
          </li>
          <li>
            <a href="/items" class="nav-link text-white">إدارة الاصناف</a>
          </li>
          <li>
            <a href="/dashboard/reports" class="nav-link text-white">التقارير</a>
          </li>
          <li>
            <a href="/dashboard/settings" class="nav-link text-white">الإعدادات</a>
          </li>
        </ul>
        <hr>
        <div>
          <a href="#" class="btn btn-outline-light w-100">تسجيل الخروج</a>
        </div>
      </div>

      <!-- Main Content -->
      <main class="flex-grow-1 overflow-hidden bg-light py-3 px-5" style="height: 100vh;">
        <header class="d-flex justify-content-between align-content-center" style="height: 6%;">
          <h3 class="">إدارة الاصناف</h3>
          <button class="btn btn-primary fw-bold" data-bs-toggle="modal" data-bs-target="#itemModal"><span class="fw-bold"> + </span>إضافة صنف </button>
        </header>

        <div
            id="itemsList"
            class="container overflow-y-auto overflow-x-hidden bg-white mt-3 p-2 rounded shadow-sm" 
            style="height: 90%; overflow-y: overlay;">
          <!-- Items table -->
          <div class="row"> <!-- Table Header -->
            <div class="col-2 fw-bold fs-5">الترقيم</div>
            <div class="col-2 fw-bold fs-5">الإسم</div>
            <div class="col-2 fw-bold fs-5">الصنف</div>
            <div class="col-2 fw-bold fs-5">السعر</div>
            <div class="col-2 fw-bold fs-5">الصورة</div>
            <div class="col-2 fw-bold fs-5">الإجراءات</div>
          </div>
          <hr>

          <% let index = 1 %>
          <% items.forEach((item) => { %>
          <div id="itemContainer" class="row d-flex align-items-center py-2" data-itemid="<%= item._id %>"> <!-- Table Row -->
            <div class="col-2"><%= index %></div>
            <div class="col-2"><%= item.name %></div>
            <div class="col-2"><%= item.category %></div>
            <div class="col-2"><%= item.price.toFixed(2) %> ج.س</div>
            <div class="col-2">
              <img src="<%= item.imageUrl %>" class="h-100 w-25" alt="item image"/>
            </div>
            <div class="col-2">
              <button class="btn btn-sm btn-warning editItem" data-bs-target="#itemModal" data-bs-toggle="modal">
                تعديل
                <i class="bi bi-pencil-square"></i>
              </button>
              <button class="btn btn-sm btn-danger deleteItem">
                حذف
                <i class="bi bi-trash-fill"></i>
              </button>
            </div>
          </div>
          <% index++; %>
          <% }); %>
        </div>
      </main>
    </div>

    <!-- Add Item Modal -->
    <!-- pop up -->
<div class="modal fade" id="itemModal" role="dialog" aria-labelledby="myModalLabel" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      
      <!-- modal header -->
      <div class="modal-header">
        <h5 id="myModalLabel" class="modal-title flex-grow-1">إضافة صنف جديد</h5>
        <button type="button" class="btn-close flex-shrink-1" data-bs-dismiss="modal" aria-label="close"></button>
      </div>

      <!-- Modal body -->
      <form id="addItemForm" enctype="multipart/form-data" method="post">
        <div class="modal-body">
          <!-- Item name -->
          <div class="mb-3">
            <label class="form-label">اسم الصنف</label>
            <input type="text" name="itemName" class="form-control" required>
          </div>

          <!-- Price -->
          <div class="mb-3">
            <label class="form-label">السعر</label>
            <input type="number" name="itemPrice" min="0" max="1000000" class="form-control" required>
          </div>

          <!-- Category -->
          <div class="mb-3">
            <label class="form-label">التصنيف</label>
            <select name="itemCategory" class="form-select">
              <option value="meals">وجبات</option>
              <option value="drinks">مشروبات</option>
              <option value="desserts">حلويات</option>
            </select>
          </div>

          <!-- Image Upload -->
          <div class="mb-3">
            <label class="form-label">صورة (اختياري)</label>
            <input type="file" name="itemImage" class="form-control" accept="image/*">
            <div class="form-text">يمكنك رفع صورة للصنف، أو تركه فارغًا.</div>
          </div>
        </div>

        <!-- Modal Footer -->
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary w-100">حفظ الصنف</button>
        </div>
      </form>
    </div>
  </div>
</div>

    <div id="statusMessage" class="status-message"></div>
    <!-- Bootstrap JS -->
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/item.js"></script>
  </body>
</html>